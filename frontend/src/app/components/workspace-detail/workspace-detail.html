<div class="workspace-detail-container">
  <!-- Header with Back Button -->
  <div class="detail-header">
    <button class="btn-back" (click)="goBack()">
      ‚Üê Back to Workspaces
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading workspace...</p>
  </div>

  <!-- Workspace Detail -->
  <div *ngIf="!isLoading && workspace()" class="detail-content">
    <!-- Main Header Section -->
    <div class="workspace-header-section">
      <div class="header-top">
        <div class="header-icon-section">
          <div class="workspace-icon-large">üíº</div>
          <div>
            <h1 class="workspace-title">{{ workspace()!.name }}</h1>
            <p class="workspace-id">Workspace ID: {{ workspace()!.id }}</p>
          </div>
        </div>
        <div class="header-actions">
          <button 
            class="btn btn-primary"
            (click)="addTask()"
            title="Add a new task to this workspace"
          >
            ‚ûï Add Task
          </button>
          <button 
            class="btn btn-secondary"
            (click)="toggleEdit()"
          >
            {{ isEditing ? '‚úï Cancel' : '‚úèÔ∏è Edit' }}
          </button>
          <button 
            class="btn btn-danger"
            (click)="deleteWorkspace()"
          >
            üóëÔ∏è Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Left Column: Details -->
      <div class="left-column">
        <!-- Description Section -->
        <div class="section card">
          <div class="section-header">
            <h2>Description</h2>
          </div>
          <div *ngIf="!isEditing" class="section-content">
            <p class="description-text">{{ workspace()!.description || 'No description provided' }}</p>
          </div>
          <div *ngIf="isEditing" class="edit-form">
            <div class="form-group">
              <label>Workspace Name</label>
              <input 
                type="text" 
                [(ngModel)]="editForm().name"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea 
                [(ngModel)]="editForm().description"
                class="form-textarea"
                rows="4"
              ></textarea>
            </div>
            <div class="edit-actions">
              <button class="btn btn-primary" (click)="saveChanges()">
                üíæ Save Changes
              </button>
              <button class="btn btn-secondary" (click)="toggleEdit()">
                ‚úï Cancel
              </button>
            </div>
          </div>
        </div>

        <!-- Info Section -->
        <div class="section card">
          <div class="section-header">
            <h2>Information</h2>
          </div>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Created</span>
              <span class="info-value">{{ workspace()!.createdAt | date: 'MMM d, y - HH:mm' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Last Updated</span>
              <span class="info-value">{{ workspace()!.updatedAt | date: 'MMM d, y - HH:mm' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Owner</span>
              <span class="info-value">{{ getUserName(workspace()!.ownerId) }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Total Members</span>
              <span class="info-value">{{ (workspace()!.members || []).length }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Members -->
      <div class="right-column">
        <div class="section card">
          <div class="section-header">
            <h2>Members</h2>
            <div class="section-header-actions">
              <span class="member-count">{{ memberUsers.length }}</span>
              <button class="btn btn-sm btn-primary" (click)="openAddMemberModal()">
                ‚ûï Add Members
              </button>
            </div>
          </div>
          <div class="members-list">
            <div *ngFor="let member of memberUsers" class="member-item">
              <div class="member-icon">üë§</div>
              <div class="member-info">
                <p class="member-name">{{ member.firstName }} {{ member.lastName }}</p>
                <p class="member-email">{{ member.email }}</p>
                <p class="member-role" [class.owner]="member.id === workspace()!.ownerId">
                  {{ member.id === workspace()!.ownerId ? 'Owner' : 'Member' }}
                </p>
              </div>
              <button 
                *ngIf="member.id !== workspace()!.ownerId"
                class="btn-remove"
                (click)="removeMember(member.id)"
                title="Remove member"
              >
                ‚úï
              </button>
            </div>
            <div *ngIf="memberUsers.length === 0" class="empty-members">
              <p>No members in this workspace</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tasks Section -->
    <div class="section card tasks-section">
      <div class="section-header">
        <h2>Tasks</h2>
        <span class="task-count">{{ tasks().length }} task(s)</span>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoadingTasks" class="loading-container">
        <div class="spinner"></div>
        <p>Loading tasks...</p>
      </div>

      <!-- Tasks Table -->
      <div *ngIf="!isLoadingTasks && tasks().length > 0" class="tasks-table-container">
        <table class="tasks-table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Status</th>
              <th>Priority</th>
              <th>Due Date</th>
              <th>Assigned To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of tasks()" class="task-row">
              <td class="task-title">{{ task.title }}</td>
              <td>
                <span class="status-badge" [class]="'status-' + task.status.toLowerCase()">
                  {{ task.status }}
                </span>
              </td>
              <td>
                <span class="priority-badge" [class]="'priority-' + task.priority.toLowerCase()">
                  {{ task.priority }}
                </span>
              </td>
              <td class="task-date">
                {{ task.dueDate | date: 'MMM d, y' }}
              </td>
              <td class="task-assigned">
                {{ task.assignedTo ? getUserName(task.assignedTo.id) : 'Unassigned' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoadingTasks && tasks().length === 0" class="empty-tasks">
        <div class="empty-icon">üìã</div>
        <p>No tasks in this workspace yet</p>
        <button class="btn btn-primary" (click)="addTask()">
          ‚ûï Create First Task
        </button>
      </div>
    </div>
  </div>

  <!-- Add Member Modal -->
  <div *ngIf="showAddMemberModal" class="modal-overlay" (click)="closeAddMemberModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Add Members to Workspace</h3>
        <button class="modal-close" (click)="closeAddMemberModal()">‚úï</button>
      </div>
      
      <div class="modal-body">
        <p class="modal-description">Select users to add to this workspace:</p>
        
        <div *ngIf="availableUsers.length === 0" class="no-users-message">
          <p>All users are already members of this workspace.</p>
        </div>
        
        <div *ngIf="availableUsers.length > 0" class="users-list">
          <div 
            *ngFor="let user of availableUsers" 
            class="user-item"
            (click)="addMemberToWorkspace(user.id)"
          >
            <div class="user-avatar">{{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}</div>
            <div class="user-info">
              <p class="user-name">{{ user.firstName }} {{ user.lastName }}</p>
              <p class="user-email">{{ user.email }}</p>
            </div>
            <button class="btn-add-user">+ Add</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Not Found State -->
  <div *ngIf="!isLoading && !workspace()" class="empty-state">
    <div class="empty-icon">‚ùå</div>
    <h2>Workspace not found</h2>
    <button class="btn btn-primary" (click)="goBack()">
      Go Back
    </button>
  </div>
</div>
